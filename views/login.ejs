<!DOCTYPE html>
<html lang="en">
<head>
	<% include inner/_meta %>
	<title>Login</title>
	<link rel="stylesheet" href="/css/basic.css" />
	<link rel="stylesheet" href="/css/text.css" />
	<link rel="stylesheet" href="/css/login.css" />
	<link rel="stylesheet" href="/css/hover-imagine.css">
	<script src="/js/userstorage.js"></script>
</head>
<body>
	<h1>登录</h1>
	<p class="intro"><%= msg %></p>

	<form id="to-login" action="/login" method="post">
		<input id="id" placeholder="Your Name" name="id" type="text" />
		<input id="pwd" placeholder="***" name="pwd" type="password" />
		<button type="submit">Login</button>
	</form>

	<p>没有帐号？</p> <a href="/register">注册 Nep 帐号</a>

	<script src="/js/jquery-3.1.0.min.js"></script>
	<script src="/js/userstorage.js"></script>
	<script>
		function setCookie(c_name, value, expiredays){
			var exdate = new Date(); 

			exdate.setDate(exdate.getDate() + expiredays);

			document.cookie = c_name+ "=" +escape(value)+
				((expiredays==null) ? "" : ";expires="+exdate.toGMTString()); 
		}

		$('#to-login').submit(function(e){
			var o = {
				id: $('#id').val(),
				pwd: $('#pwd').val()
			}; 
			
			$.ajax({
				method: 'post',
				url: '/login',
				data: o,
				dataType: 'json',
				success: function(res){
					if (res.code == 200){
						setCookie('auth', res.data.auth, 15); 
						us.setUser(res.data); 
						window.location.href = '/'; 
					} else {
						alert('帐号密码错误，请重试'); 
					}
				}, 
				error: function(xhr, err, type){
					alert('帐号密码错误，请重试');
				}
			});

			return false; 
		});
	</script>
</body>
</html>